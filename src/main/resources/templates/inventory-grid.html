<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/header :: head('Portal de Coches - Inventario')}"></head>

<body>
    <nav th:replace="~{fragments/header :: navbar}"></nav>


    <!-- sidebar-popup -->
    <div class="sidebar-popup">
        <div class="sidebar-wrapper">
            <div class="sidebar-content">
                <button type="button" class="close-sidebar-popup"><i class="far fa-xmark"></i></button>
                <div class="sidebar-logo">
                    <img src="/img/logo/logo.png" alt="">
                </div>
                <div class="sidebar-about">
                    <h4>About Us</h4>
                    <p>There are many variations of passages available sure there majority have suffered alteration in
                        some form by injected humour or randomised words which don't look even slightly believable.</p>
                </div>
                <div class="sidebar-contact">
                    <h4>Contact Info</h4>
                    <ul>
                        <li>
                            <h6>Email</h6>
                            <a href="mailto:info@example.com"><i class="far fa-envelope"></i>info@example.com</a>
                        </li>
                        <li>
                            <h6>Phone</h6>
                            <a href="tel:+21236547898"><i class="far fa-phone"></i>+2 123 654 7898</a>
                        </li>
                        <li>
                            <h6>Address</h6>
                            <a href="#"><i class="far fa-location-dot"></i>25/B Milford Road, New York</a>
                        </li>
                    </ul>
                </div>
                <div class="sidebar-social">
                    <h4>Follow Us</h4>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>
    </div>
    <!-- sidebar-popup end -->


    <main class="main">

        <!-- breadcrumb -->
        <div class="site-breadcrumb" style="background: url(/img/breadcrumb/01.jpg)">
            <div class="container">
                <h2 class="breadcrumb-title">Inventory Grid</h2>
                <ul class="breadcrumb-menu">
                    <li><a th:href="@{/}">Home</a></li>
                    <li class="active">Inventory Grid</li>
                </ul>
            </div>
        </div>
        <!-- breadcrumb end -->



        <!-- car area -->
        <div class="car-area grid bg py-120">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="car-sidebar">
                            <form th:action="@{/cars}" method="get">
                                <div class="car-widget">
                                    <div class="car-search-form">
                                        <h4 class="car-widget-title">Search</h4>
                                        <div class="form-group">
                                            <input type="text" name="searchText" class="form-control"
                                                   th:value="${filters.searchText}" placeholder="Search">
                                            <button type="submit"><i class="far fa-search"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="car-widget">
                                    <h4 class="car-widget-title">Brands</h4>
                                    <ul>
                                        <li th:each="brand, iterStat : ${availableBrands}">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                       name="brands" th:value="${brand}"
                                                       th:id="'brand' + ${iterStat.index}"
                                                       th:checked="${filters.brands != null && filters.brands.contains(brand)}">
                                                <label class="form-check-label" th:for="'brand' + ${iterStat.index}"
                                                       th:text="${brand}">Brand</label>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="car-widget">
                                    <h4 class="car-widget-title">Price Range</h4>
                                    <div class="form-group">
                                        <label>Min Price (€)</label>
                                        <input type="number" name="minPrice" class="form-control"
                                               th:value="${filters.minPrice}" placeholder="0">
                                    </div>
                                    <div class="form-group">
                                        <label>Max Price (€)</label>
                                        <input type="number" name="maxPrice" class="form-control"
                                               th:value="${filters.maxPrice}" placeholder="100000">
                                    </div>
                                </div>
                                <div class="car-widget">
                                    <h4 class="car-widget-title">Transmission</h4>
                                    <ul>
                                        <li th:each="trans : ${transmissionTypes}">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio"
                                                       name="transmission" th:value="${trans.name()}"
                                                       th:id="'trans' + ${trans.name()}"
                                                       th:checked="${filters.transmission == trans.name()}">
                                                <label class="form-check-label" th:for="'trans' + ${trans.name()}"
                                                       th:text="${trans}">Transmission</label>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="car-widget">
                                    <h4 class="car-widget-title">Fuel Type</h4>
                                    <ul>
                                        <li th:each="fuel : ${fuelTypes}">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio"
                                                       name="fuelType" th:value="${fuel.name()}"
                                                       th:id="'fuel' + ${fuel.name()}"
                                                       th:checked="${filters.fuelType == fuel.name()}">
                                                <label class="form-check-label" th:for="'fuel' + ${fuel.name()}"
                                                       th:text="${fuel}">Fuel</label>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="car-widget">
                                    <button type="submit" class="theme-btn w-100">
                                        <i class="far fa-filter"></i> Apply Filters
                                    </button>
                                    <a th:href="@{/cars}" class="theme-btn theme-btn2 w-100 mt-2">
                                        <i class="far fa-times"></i> Clear Filters
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="col-md-12">
                            <div class="car-sort">
                                <h6 th:text="'Showing ' + ${cars.numberOfElements} + ' of ' + ${totalItems} + ' Results'">Showing 1-10 of 50 Results</h6>
                                <button id="compareBtn" class="theme-btn" style="display: none; margin-left: 15px;">
                                    <span class="far fa-arrows-repeat"></span> Compare (<span id="compareCount">0</span>)
                                </button>
                                <div class="car-sort-list-grid">
                                    <a class="car-sort-grid active" th:href="@{/cars}"><i class="far fa-grid-2"></i></a>
                                    <a class="car-sort-list" th:href="@{/cars/list}"><i class="far fa-list-ul"></i></a>
                                </div>
                                <div class="col-md-3 car-sort-box">
                                    <form th:action="@{/cars}" method="get">
                                        <input type="hidden" th:each="brand : ${filters.brands}"
                                               name="brands" th:value="${brand}">
                                        <input type="hidden" name="minPrice" th:value="${filters.minPrice}">
                                        <input type="hidden" name="maxPrice" th:value="${filters.maxPrice}">
                                        <input type="hidden" name="transmission" th:value="${filters.transmission}">
                                        <input type="hidden" name="fuelType" th:value="${filters.fuelType}">
                                        <select name="sortBy" class="select" onchange="this.form.submit()">
                                            <option value="">Sort By Default</option>
                                            <option value="date_desc" th:selected="${filters.sortBy == 'date_desc'}">Sort By Latest</option>
                                            <option value="price_asc" th:selected="${filters.sortBy == 'price_asc'}">Sort By Low Price</option>
                                            <option value="price_desc" th:selected="${filters.sortBy == 'price_desc'}">Sort By High Price</option>
                                            <option value="year_desc" th:selected="${filters.sortBy == 'year_desc'}">Sort By Year</option>
                                            <option value="mileage_asc" th:selected="${filters.sortBy == 'mileage_asc'}">Sort By Mileage</option>
                                        </select>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-4" th:each="car : ${cars}">
                                <div class="car-item">
                                    <div class="car-img">
                                        <span class="car-status"
                                              th:classappend="${car.condition.name() == 'NUEVO'} ? 'status-2' : 'status-1'"
                                              th:text="${car.condition}">Used</span>
                                        <img th:src="@{${car.images != null && !car.images.isEmpty()} ? '/uploads/' + ${car.images[0]} : '/img/car/01.jpg'}"
                                             th:alt="${car.make + ' ' + car.model}">
                                        <div class="car-btns">
                                            <a href="#"><i class="far fa-heart"></i></a>
                                            <a href="#" class="compare-checkbox-btn" th:data-car-id="${car.id}">
                                                <i class="far fa-arrows-repeat"></i>
                                            </a>
                                        </div>
                                        <div class="compare-checkbox">
                                            <input type="checkbox" class="compare-car-checkbox"
                                                   th:id="'compare-' + ${car.id}"
                                                   th:value="${car.id}">
                                            <label th:for="'compare-' + ${car.id}">Compare</label>
                                        </div>
                                    </div>
                                    <div class="car-content">
                                        <div class="car-top">
                                            <h4><a th:href="@{/cars/{id}(id=${car.id})}"
                                                   th:text="${car.make + ' ' + car.model}">Mercedes Benz Car</a></h4>
                                            <div class="car-rate">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <span>5.0</span>
                                            </div>
                                        </div>
                                        <ul class="car-list">
                                            <li><i class="far fa-steering-wheel"></i><span th:text="${car.transmission}">Automatic</span></li>
                                            <li><i class="far fa-road"></i><span th:text="${car.mileage + ' km'}">10.15km</span></li>
                                            <li><i class="far fa-car"></i>Model: <span th:text="${car.year}">2023</span></li>
                                            <li><i class="far fa-gas-pump"></i><span th:text="${car.fuelType}">Hybrid</span></li>
                                        </ul>
                                        <div class="car-footer">
                                            <span class="car-price" th:text="${#numbers.formatDecimal(car.price, 0, 'COMMA', 2, 'POINT')} + ' €'">$45,620</span>
                                            <a th:href="@{/cars/{id}(id=${car.id})}" class="theme-btn"><span class="far fa-eye"></span>Details</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- pagination -->
                        <div class="pagination-area" th:if="${totalPages > 1}">
                            <div aria-label="Page navigation example">
                                <ul class="pagination">
                                    <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                                        <a class="page-link"
                                           th:href="@{/cars(page=${currentPage - 1}, size=12,
                                                   brands=${filters.brands}, minPrice=${filters.minPrice},
                                                   maxPrice=${filters.maxPrice}, transmission=${filters.transmission},
                                                   fuelType=${filters.fuelType}, sortBy=${filters.sortBy})}"
                                           aria-label="Previous">
                                            <span aria-hidden="true"><i class="far fa-arrow-left"></i></span>
                                        </a>
                                    </li>
                                    <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                        th:classappend="${i == currentPage} ? 'active'">
                                        <a class="page-link"
                                           th:href="@{/cars(page=${i}, size=12,
                                                   brands=${filters.brands}, minPrice=${filters.minPrice},
                                                   maxPrice=${filters.maxPrice}, transmission=${filters.transmission},
                                                   fuelType=${filters.fuelType}, sortBy=${filters.sortBy})}"
                                           th:text="${i + 1}">1</a>
                                    </li>
                                    <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                                        <a class="page-link"
                                           th:href="@{/cars(page=${currentPage + 1}, size=12,
                                                   brands=${filters.brands}, minPrice=${filters.minPrice},
                                                   maxPrice=${filters.maxPrice}, transmission=${filters.transmission},
                                                   fuelType=${filters.fuelType}, sortBy=${filters.sortBy})}"
                                           aria-label="Next">
                                            <span aria-hidden="true"><i class="far fa-arrow-right"></i></span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- pagination end -->
                    </div>
                </div>
            </div>
        </div>
        <!-- car area end -->

    </main>



    <footer th:replace="~{fragments/footer :: footer}"></footer>

    <div th:replace="~{fragments/footer :: scroll-top}"></div>

    <div th:replace="~{fragments/header :: scripts}"></div>
    
    <script>
        // Car comparison functionality
        $(document).ready(function() {
            let selectedCars = [];
            const maxCompare = 3;
            
            // Handle checkbox change
            $('.compare-car-checkbox').on('change', function() {
                const carId = $(this).val();
                
                if ($(this).is(':checked')) {
                    if (selectedCars.length < maxCompare) {
                        selectedCars.push(carId);
                    } else {
                        $(this).prop('checked', false);
                        alert('You can only compare up to ' + maxCompare + ' cars at a time.');
                    }
                } else {
                    selectedCars = selectedCars.filter(id => id !== carId);
                }
                
                updateCompareButton();
            });
            
            // Handle compare icon click
            $('.compare-checkbox-btn').on('click', function(e) {
                e.preventDefault();
                const carId = $(this).data('car-id');
                const checkbox = $('#compare-' + carId);
                checkbox.prop('checked', !checkbox.is(':checked')).trigger('change');
            });
            
            // Update compare button visibility and count
            function updateCompareButton() {
                const count = selectedCars.length;
                $('#compareCount').text(count);
                
                if (count >= 2) {
                    $('#compareBtn').show();
                } else {
                    $('#compareBtn').hide();
                }
            }
            
            // Handle compare button click
            $('#compareBtn').on('click', function() {
                if (selectedCars.length >= 2) {
                    const compareUrl = '/cars/compare?ids=' + selectedCars.join('&ids=');
                    window.location.href = compareUrl;
                }
            });
        });
    </script>

</body>

</html>